\hypertarget{arch_2AVX_2MathFunctions_8h_source}{}\doxysection{Math\+Functions.\+h}
\label{arch_2AVX_2MathFunctions_8h_source}\index{include/Eigen/src/Core/arch/AVX/MathFunctions.h@{include/Eigen/src/Core/arch/AVX/MathFunctions.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}}
\DoxyCodeLine{2 \textcolor{comment}{// for linear algebra.}}
\DoxyCodeLine{3 \textcolor{comment}{//}}
\DoxyCodeLine{4 \textcolor{comment}{// Copyright (C) 2014 Pedro Gonnet (pedro.gonnet@gmail.com)}}
\DoxyCodeLine{5 \textcolor{comment}{//}}
\DoxyCodeLine{6 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}}
\DoxyCodeLine{7 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}}
\DoxyCodeLine{8 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#ifndef EIGEN\_MATH\_FUNCTIONS\_AVX\_H}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#define EIGEN\_MATH\_FUNCTIONS\_AVX\_H}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{comment}{/* The sin and cos functions of this file are loosely derived from}}
\DoxyCodeLine{14 \textcolor{comment}{ * Julien Pommier's sse math library: http://gruntthepeon.free.fr/ssemath/}}
\DoxyCodeLine{15 \textcolor{comment}{ */}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}../../InternalHeaderCheck.h"{}}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceEigen}{Eigen}} \{}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{keyword}{namespace }internal \{}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{keyword}{template} <>}
\DoxyCodeLine{24 EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED Packet8f}
\DoxyCodeLine{25 psin<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{26   \textcolor{keywordflow}{return} psin\_float(\_x);}
\DoxyCodeLine{27 \}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{keyword}{template} <>}
\DoxyCodeLine{30 EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED Packet8f}
\DoxyCodeLine{31 pcos<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{32   \textcolor{keywordflow}{return} pcos\_float(\_x);}
\DoxyCodeLine{33 \}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{keyword}{template} <>}
\DoxyCodeLine{36 EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED Packet8f}
\DoxyCodeLine{37 plog<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{38   \textcolor{keywordflow}{return} plog\_float(\_x);}
\DoxyCodeLine{39 \}}
\DoxyCodeLine{40 }
\DoxyCodeLine{41 \textcolor{keyword}{template} <>}
\DoxyCodeLine{42 EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED Packet4d}
\DoxyCodeLine{43 plog<Packet4d>(\textcolor{keyword}{const} Packet4d\& \_x) \{}
\DoxyCodeLine{44   \textcolor{keywordflow}{return} plog\_double(\_x);}
\DoxyCodeLine{45 \}}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 \textcolor{keyword}{template} <>}
\DoxyCodeLine{48 EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED Packet8f}
\DoxyCodeLine{49 plog2<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{50   \textcolor{keywordflow}{return} plog2\_float(\_x);}
\DoxyCodeLine{51 \}}
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \textcolor{keyword}{template} <>}
\DoxyCodeLine{54 EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED Packet4d}
\DoxyCodeLine{55 plog2<Packet4d>(\textcolor{keyword}{const} Packet4d\& \_x) \{}
\DoxyCodeLine{56   \textcolor{keywordflow}{return} plog2\_double(\_x);}
\DoxyCodeLine{57 \}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{60 Packet8f plog1p<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{61   \textcolor{keywordflow}{return} generic\_plog1p(\_x);}
\DoxyCodeLine{62 \}}
\DoxyCodeLine{63 }
\DoxyCodeLine{64 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{65 Packet8f pexpm1<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{66   \textcolor{keywordflow}{return} generic\_expm1(\_x);}
\DoxyCodeLine{67 \}}
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{comment}{// Exponential function. Works by writing "{}x = m*log(2) + r"{} where}}
\DoxyCodeLine{70 \textcolor{comment}{// "{}m = floor(x/log(2)+1/2)"{} and "{}r"{} is the remainder. The result is then}}
\DoxyCodeLine{71 \textcolor{comment}{// "{}exp(x) = 2\string^m*exp(r)"{} where exp(r) is in the range [-\/1,1).}}
\DoxyCodeLine{72 \textcolor{keyword}{template} <>}
\DoxyCodeLine{73 EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED Packet8f}
\DoxyCodeLine{74 pexp<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{75   \textcolor{keywordflow}{return} pexp\_float(\_x);}
\DoxyCodeLine{76 \}}
\DoxyCodeLine{77 }
\DoxyCodeLine{78 \textcolor{comment}{// Hyperbolic Tangent function.}}
\DoxyCodeLine{79 \textcolor{keyword}{template} <>}
\DoxyCodeLine{80 EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED Packet8f}
\DoxyCodeLine{81 ptanh<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{82   \textcolor{keywordflow}{return} internal::generic\_fast\_tanh\_float(\_x);}
\DoxyCodeLine{83 \}}
\DoxyCodeLine{84 }
\DoxyCodeLine{85 \textcolor{comment}{// Exponential function for doubles.}}
\DoxyCodeLine{86 \textcolor{keyword}{template} <>}
\DoxyCodeLine{87 EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED Packet4d}
\DoxyCodeLine{88 pexp<Packet4d>(\textcolor{keyword}{const} Packet4d\& \_x) \{}
\DoxyCodeLine{89   \textcolor{keywordflow}{return} pexp\_double(\_x);}
\DoxyCodeLine{90 \}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92 \textcolor{comment}{// Functions for sqrt.}}
\DoxyCodeLine{93 \textcolor{comment}{// The EIGEN\_FAST\_MATH version uses the \_mm\_rsqrt\_ps approximation and one step}}
\DoxyCodeLine{94 \textcolor{comment}{// of Newton's method, at a cost of 1-\/2 bits of precision as opposed to the}}
\DoxyCodeLine{95 \textcolor{comment}{// exact solution. It does not handle +inf, or denormalized numbers correctly.}}
\DoxyCodeLine{96 \textcolor{comment}{// The main advantage of this approach is not just speed, but also the fact that}}
\DoxyCodeLine{97 \textcolor{comment}{// it can be inlined and pipelined with other computations, further reducing its}}
\DoxyCodeLine{98 \textcolor{comment}{// effective latency. This is similar to Quake3's fast inverse square root.}}
\DoxyCodeLine{99 \textcolor{comment}{// For detail see here: http://www.beyond3d.com/content/articles/8/}}
\DoxyCodeLine{100 \textcolor{preprocessor}{\#if EIGEN\_FAST\_MATH}}
\DoxyCodeLine{101 \textcolor{keyword}{template} <>}
\DoxyCodeLine{102 EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{103 Packet8f psqrt<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{104   Packet8f minus\_half\_x = pmul(\_x, pset1<Packet8f>(-\/0.5f));}
\DoxyCodeLine{105   Packet8f denormal\_mask = pandnot(}
\DoxyCodeLine{106       pcmp\_lt(\_x, pset1<Packet8f>((std::numeric\_limits<float>::min)())),}
\DoxyCodeLine{107       pcmp\_lt(\_x, pzero(\_x)));}
\DoxyCodeLine{108 }
\DoxyCodeLine{109   \textcolor{comment}{// Compute approximate reciprocal sqrt.}}
\DoxyCodeLine{110   Packet8f x = \_mm256\_rsqrt\_ps(\_x);}
\DoxyCodeLine{111   \textcolor{comment}{// Do a single step of Newton's iteration.}}
\DoxyCodeLine{112   x = pmul(x, pmadd(minus\_half\_x, pmul(x,x), pset1<Packet8f>(1.5f)));}
\DoxyCodeLine{113   \textcolor{comment}{// Flush results for denormals to zero.}}
\DoxyCodeLine{114   \textcolor{keywordflow}{return} pandnot(pmul(\_x,x), denormal\_mask);}
\DoxyCodeLine{115 \}}
\DoxyCodeLine{116 }
\DoxyCodeLine{117 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119 \textcolor{keyword}{template} <> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{120 Packet8f psqrt<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{121   \textcolor{keywordflow}{return} \_mm256\_sqrt\_ps(\_x);}
\DoxyCodeLine{122 \}}
\DoxyCodeLine{123 }
\DoxyCodeLine{124 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{125 }
\DoxyCodeLine{126 \textcolor{keyword}{template} <> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{127 Packet4d psqrt<Packet4d>(\textcolor{keyword}{const} Packet4d\& \_x) \{}
\DoxyCodeLine{128   \textcolor{keywordflow}{return} \_mm256\_sqrt\_pd(\_x);}
\DoxyCodeLine{129 \}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131 \textcolor{preprocessor}{\#if EIGEN\_FAST\_MATH}}
\DoxyCodeLine{132 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{133 Packet8f prsqrt<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{134   \_EIGEN\_DECLARE\_CONST\_Packet8f\_FROM\_INT(inf, 0x7f800000);}
\DoxyCodeLine{135   \_EIGEN\_DECLARE\_CONST\_Packet8f(one\_point\_five, 1.5f);}
\DoxyCodeLine{136   \_EIGEN\_DECLARE\_CONST\_Packet8f(minus\_half, -\/0.5f);}
\DoxyCodeLine{137   \_EIGEN\_DECLARE\_CONST\_Packet8f\_FROM\_INT(flt\_min, 0x00800000);}
\DoxyCodeLine{138 }
\DoxyCodeLine{139   Packet8f neg\_half = pmul(\_x, p8f\_minus\_half);}
\DoxyCodeLine{140 }
\DoxyCodeLine{141   \textcolor{comment}{// select only the inverse sqrt of positive normal inputs (denormals are}}
\DoxyCodeLine{142   \textcolor{comment}{// flushed to zero and cause infs as well).}}
\DoxyCodeLine{143   Packet8f lt\_min\_mask = \_mm256\_cmp\_ps(\_x, p8f\_flt\_min, \_CMP\_LT\_OQ);}
\DoxyCodeLine{144   Packet8f inf\_mask =  \_mm256\_cmp\_ps(\_x, p8f\_inf, \_CMP\_EQ\_OQ);}
\DoxyCodeLine{145   Packet8f not\_normal\_finite\_mask = \_mm256\_or\_ps(lt\_min\_mask, inf\_mask);}
\DoxyCodeLine{146 }
\DoxyCodeLine{147   \textcolor{comment}{// Compute an approximate result using the rsqrt intrinsic.}}
\DoxyCodeLine{148   Packet8f y\_approx = \_mm256\_rsqrt\_ps(\_x);}
\DoxyCodeLine{149 }
\DoxyCodeLine{150   \textcolor{comment}{// Do a single step of Newton-\/Raphson iteration to improve the approximation.}}
\DoxyCodeLine{151   \textcolor{comment}{// This uses the formula y\_\{n+1\} = y\_n * (1.5 -\/ y\_n * (0.5 * x) * y\_n).}}
\DoxyCodeLine{152   \textcolor{comment}{// It is essential to evaluate the inner term like this because forming}}
\DoxyCodeLine{153   \textcolor{comment}{// y\_n\string^2 may over-\/ or underflow.}}
\DoxyCodeLine{154   Packet8f y\_newton = pmul(y\_approx, pmadd(y\_approx, pmul(neg\_half, y\_approx), p8f\_one\_point\_five));}
\DoxyCodeLine{155 }
\DoxyCodeLine{156   \textcolor{comment}{// Select the result of the Newton-\/Raphson step for positive normal arguments.}}
\DoxyCodeLine{157   \textcolor{comment}{// For other arguments, choose the output of the intrinsic. This will}}
\DoxyCodeLine{158   \textcolor{comment}{// return rsqrt(+inf) = 0, rsqrt(x) = NaN if x < 0, and rsqrt(x) = +inf if}}
\DoxyCodeLine{159   \textcolor{comment}{// x is zero or a positive denormalized float (equivalent to flushing positive}}
\DoxyCodeLine{160   \textcolor{comment}{// denormalized inputs to zero).}}
\DoxyCodeLine{161   \textcolor{keywordflow}{return} pselect<Packet8f>(not\_normal\_finite\_mask, y\_approx, y\_newton);}
\DoxyCodeLine{162 \}}
\DoxyCodeLine{163 }
\DoxyCodeLine{164 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{165 \textcolor{keyword}{template} <> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{166 Packet8f prsqrt<Packet8f>(\textcolor{keyword}{const} Packet8f\& \_x) \{}
\DoxyCodeLine{167   \_EIGEN\_DECLARE\_CONST\_Packet8f(one, 1.0f);}
\DoxyCodeLine{168   \textcolor{keywordflow}{return} \_mm256\_div\_ps(p8f\_one, \_mm256\_sqrt\_ps(\_x));}
\DoxyCodeLine{169 \}}
\DoxyCodeLine{170 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{171 }
\DoxyCodeLine{172 \textcolor{keyword}{template} <> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{173 Packet4d prsqrt<Packet4d>(\textcolor{keyword}{const} Packet4d\& \_x) \{}
\DoxyCodeLine{174   \_EIGEN\_DECLARE\_CONST\_Packet4d(one, 1.0);}
\DoxyCodeLine{175   \textcolor{keywordflow}{return} \_mm256\_div\_pd(p4d\_one, \_mm256\_sqrt\_pd(\_x));}
\DoxyCodeLine{176 \}}
\DoxyCodeLine{177 }
\DoxyCodeLine{178 F16\_PACKET\_FUNCTION(Packet8f, Packet8h, psin)}
\DoxyCodeLine{179 F16\_PACKET\_FUNCTION(Packet8f, Packet8h, pcos)}
\DoxyCodeLine{180 F16\_PACKET\_FUNCTION(Packet8f, Packet8h, plog)}
\DoxyCodeLine{181 F16\_PACKET\_FUNCTION(Packet8f, Packet8h, plog2)}
\DoxyCodeLine{182 F16\_PACKET\_FUNCTION(Packet8f, Packet8h, plog1p)}
\DoxyCodeLine{183 F16\_PACKET\_FUNCTION(Packet8f, Packet8h, pexpm1)}
\DoxyCodeLine{184 F16\_PACKET\_FUNCTION(Packet8f, Packet8h, pexp)}
\DoxyCodeLine{185 F16\_PACKET\_FUNCTION(Packet8f, Packet8h, ptanh)}
\DoxyCodeLine{186 F16\_PACKET\_FUNCTION(Packet8f, Packet8h, psqrt)}
\DoxyCodeLine{187 F16\_PACKET\_FUNCTION(Packet8f, Packet8h, prsqrt)}
\DoxyCodeLine{188 }
\DoxyCodeLine{189 \textcolor{keyword}{template} <>}
\DoxyCodeLine{190 EIGEN\_STRONG\_INLINE Packet8h pfrexp(\textcolor{keyword}{const} Packet8h\& a, Packet8h\& exponent) \{}
\DoxyCodeLine{191   Packet8f fexponent;}
\DoxyCodeLine{192   \textcolor{keyword}{const} Packet8h out = float2half(pfrexp<Packet8f>(half2float(a), fexponent));}
\DoxyCodeLine{193   exponent = float2half(fexponent);}
\DoxyCodeLine{194   \textcolor{keywordflow}{return} out;}
\DoxyCodeLine{195 \}}
\DoxyCodeLine{196 }
\DoxyCodeLine{197 \textcolor{keyword}{template} <>}
\DoxyCodeLine{198 EIGEN\_STRONG\_INLINE Packet8h pldexp(\textcolor{keyword}{const} Packet8h\& a, \textcolor{keyword}{const} Packet8h\& exponent) \{}
\DoxyCodeLine{199   \textcolor{keywordflow}{return} float2half(pldexp<Packet8f>(half2float(a), half2float(exponent)));}
\DoxyCodeLine{200 \}}
\DoxyCodeLine{201 }
\DoxyCodeLine{202 BF16\_PACKET\_FUNCTION(Packet8f, Packet8bf, psin)}
\DoxyCodeLine{203 BF16\_PACKET\_FUNCTION(Packet8f, Packet8bf, pcos)}
\DoxyCodeLine{204 BF16\_PACKET\_FUNCTION(Packet8f, Packet8bf, plog)}
\DoxyCodeLine{205 BF16\_PACKET\_FUNCTION(Packet8f, Packet8bf, plog2)}
\DoxyCodeLine{206 BF16\_PACKET\_FUNCTION(Packet8f, Packet8bf, plog1p)}
\DoxyCodeLine{207 BF16\_PACKET\_FUNCTION(Packet8f, Packet8bf, pexpm1)}
\DoxyCodeLine{208 BF16\_PACKET\_FUNCTION(Packet8f, Packet8bf, pexp)}
\DoxyCodeLine{209 BF16\_PACKET\_FUNCTION(Packet8f, Packet8bf, ptanh)}
\DoxyCodeLine{210 BF16\_PACKET\_FUNCTION(Packet8f, Packet8bf, psqrt)}
\DoxyCodeLine{211 BF16\_PACKET\_FUNCTION(Packet8f, Packet8bf, prsqrt)}
\DoxyCodeLine{212 }
\DoxyCodeLine{213 \textcolor{keyword}{template} <>}
\DoxyCodeLine{214 EIGEN\_STRONG\_INLINE Packet8bf pfrexp(\textcolor{keyword}{const} Packet8bf\& a, Packet8bf\& exponent) \{}
\DoxyCodeLine{215   Packet8f fexponent;}
\DoxyCodeLine{216   \textcolor{keyword}{const} Packet8bf out = F32ToBf16(pfrexp<Packet8f>(Bf16ToF32(a), fexponent));}
\DoxyCodeLine{217   exponent = F32ToBf16(fexponent);}
\DoxyCodeLine{218   \textcolor{keywordflow}{return} out;}
\DoxyCodeLine{219 \}}
\DoxyCodeLine{220 }
\DoxyCodeLine{221 \textcolor{keyword}{template} <>}
\DoxyCodeLine{222 EIGEN\_STRONG\_INLINE Packet8bf pldexp(\textcolor{keyword}{const} Packet8bf\& a, \textcolor{keyword}{const} Packet8bf\& exponent) \{}
\DoxyCodeLine{223   \textcolor{keywordflow}{return} F32ToBf16(pldexp<Packet8f>(Bf16ToF32(a), Bf16ToF32(exponent)));}
\DoxyCodeLine{224 \}}
\DoxyCodeLine{225 }
\DoxyCodeLine{226 \}  \textcolor{comment}{// end namespace internal}}
\DoxyCodeLine{227 }
\DoxyCodeLine{228 \}  \textcolor{comment}{// end namespace Eigen}}
\DoxyCodeLine{229 }
\DoxyCodeLine{230 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// EIGEN\_MATH\_FUNCTIONS\_AVX\_H}}

\end{DoxyCode}
