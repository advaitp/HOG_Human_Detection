\hypertarget{TriangularSolverMatrix_8h_source}{}\doxysection{Triangular\+Solver\+Matrix.\+h}
\label{TriangularSolverMatrix_8h_source}\index{include/Eigen/src/Core/products/TriangularSolverMatrix.h@{include/Eigen/src/Core/products/TriangularSolverMatrix.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}}
\DoxyCodeLine{2 \textcolor{comment}{// for linear algebra.}}
\DoxyCodeLine{3 \textcolor{comment}{//}}
\DoxyCodeLine{4 \textcolor{comment}{// Copyright (C) 2009 Gael Guennebaud <gael.guennebaud@inria.fr>}}
\DoxyCodeLine{5 \textcolor{comment}{//}}
\DoxyCodeLine{6 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}}
\DoxyCodeLine{7 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}}
\DoxyCodeLine{8 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#ifndef EIGEN\_TRIANGULAR\_SOLVER\_MATRIX\_H}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#define EIGEN\_TRIANGULAR\_SOLVER\_MATRIX\_H}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include "{}../InternalHeaderCheck.h"{}}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceEigen}{Eigen}} \{ }
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{keyword}{namespace }internal \{}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{comment}{// if the rhs is row major, let's transpose the product}}
\DoxyCodeLine{20 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar, \textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} S\textcolor{keywordtype}{id}e, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{bool} Conjugate, \textcolor{keywordtype}{int} TriStorageOrder, \textcolor{keywordtype}{int} OtherInnerStr\textcolor{keywordtype}{id}e>}
\DoxyCodeLine{21 \textcolor{keyword}{struct }\mbox{\hyperlink{structEigen_1_1internal_1_1triangular__solve__matrix}{triangular\_solve\_matrix}}<Scalar,\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}},Side,Mode,\mbox{\hyperlink{classEigen_1_1Conjugate}{Conjugate}},TriStorageOrder,\mbox{\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a77c993a8d9f6efe5c1159fb2ab07dd4f}{RowMajor}},OtherInnerStride>}
\DoxyCodeLine{22 \{}
\DoxyCodeLine{23   \textcolor{keyword}{static} \textcolor{keywordtype}{void} run(}
\DoxyCodeLine{24     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} size, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} cols,}
\DoxyCodeLine{25     \textcolor{keyword}{const} Scalar*  tri, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} triStride,}
\DoxyCodeLine{26     Scalar* \_other, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherIncr, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherStride,}
\DoxyCodeLine{27     \mbox{\hyperlink{classEigen_1_1internal_1_1level3__blocking}{level3\_blocking<Scalar,Scalar>}}\& blocking)}
\DoxyCodeLine{28   \{}
\DoxyCodeLine{29     \mbox{\hyperlink{structEigen_1_1internal_1_1triangular__solve__matrix}{triangular\_solve\_matrix}}<}
\DoxyCodeLine{30       Scalar, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}, Side==\mbox{\hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba21b30a61e9cb10c967aec17567804007}{OnTheLeft}}?\mbox{\hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba329fc3a54ceb2b6e0e73b400998b8a82}{OnTheRight}}:\mbox{\hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba21b30a61e9cb10c967aec17567804007}{OnTheLeft}},}
\DoxyCodeLine{31       (Mode\&\mbox{\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda2ef430bff6cc12c2d1e0ef01b95f7ff3}{UnitDiag}}) | ((Mode\&\mbox{\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdafca2ccebb604f171656deb53e8c083c1}{Upper}}) ? \mbox{\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaf581029282d421eee5aae14238c6f749}{Lower}} : \mbox{\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdafca2ccebb604f171656deb53e8c083c1}{Upper}}),}
\DoxyCodeLine{32       \mbox{\hyperlink{structEigen_1_1NumTraits}{NumTraits<Scalar>::IsComplex}} \&\& \mbox{\hyperlink{classEigen_1_1Conjugate}{Conjugate}},}
\DoxyCodeLine{33       TriStorageOrder==\mbox{\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a77c993a8d9f6efe5c1159fb2ab07dd4f}{RowMajor}} ? \mbox{\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0103672ae41005ab03b4176c765afd62}{ColMajor}} : \mbox{\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a77c993a8d9f6efe5c1159fb2ab07dd4f}{RowMajor}}, \mbox{\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0103672ae41005ab03b4176c765afd62}{ColMajor}}, OtherInnerStride>}
\DoxyCodeLine{34       ::run(size, cols, tri, triStride, \_other, otherIncr, otherStride, blocking);}
\DoxyCodeLine{35   \}}
\DoxyCodeLine{36 \};}
\DoxyCodeLine{37 }
\DoxyCodeLine{38 \textcolor{comment}{/* Optimized triangular solver with multiple right hand side and the triangular matrix on the left}}
\DoxyCodeLine{39 \textcolor{comment}{ */}}
\DoxyCodeLine{40 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar, \textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{bool} Conjugate, \textcolor{keywordtype}{int} TriStorageOrder,\textcolor{keywordtype}{int} OtherInnerStr\textcolor{keywordtype}{id}e>}
\DoxyCodeLine{41 \textcolor{keyword}{struct }\mbox{\hyperlink{structEigen_1_1internal_1_1triangular__solve__matrix}{triangular\_solve\_matrix}}<Scalar,\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}},\mbox{\hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba21b30a61e9cb10c967aec17567804007}{OnTheLeft}},Mode,\mbox{\hyperlink{classEigen_1_1Conjugate}{Conjugate}},TriStorageOrder,\mbox{\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0103672ae41005ab03b4176c765afd62}{ColMajor}},OtherInnerStride>}
\DoxyCodeLine{42 \{}
\DoxyCodeLine{43   \textcolor{keyword}{static} EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} run(}
\DoxyCodeLine{44     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} size, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherSize,}
\DoxyCodeLine{45     \textcolor{keyword}{const} Scalar* \_tri, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} triStride,}
\DoxyCodeLine{46     Scalar* \_other, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherIncr, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherStride,}
\DoxyCodeLine{47     \mbox{\hyperlink{classEigen_1_1internal_1_1level3__blocking}{level3\_blocking<Scalar,Scalar>}}\& blocking);}
\DoxyCodeLine{48 \};}
\DoxyCodeLine{49 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar, \textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{bool} Conjugate, \textcolor{keywordtype}{int} TriStorageOrder, \textcolor{keywordtype}{int} OtherInnerStr\textcolor{keywordtype}{id}e>}
\DoxyCodeLine{50 EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} \mbox{\hyperlink{structEigen_1_1internal_1_1triangular__solve__matrix}{triangular\_solve\_matrix<Scalar,Index,OnTheLeft,Mode,Conjugate,TriStorageOrder,ColMajor,OtherInnerStride>::run}}(}
\DoxyCodeLine{51     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} size, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherSize,}
\DoxyCodeLine{52     \textcolor{keyword}{const} Scalar* \_tri, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} triStride,}
\DoxyCodeLine{53     Scalar* \_other, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherIncr, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherStride,}
\DoxyCodeLine{54     \mbox{\hyperlink{classEigen_1_1internal_1_1level3__blocking}{level3\_blocking<Scalar,Scalar>}}\& blocking)}
\DoxyCodeLine{55   \{}
\DoxyCodeLine{56     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} cols = otherSize;}
\DoxyCodeLine{57 }
\DoxyCodeLine{58     \textcolor{keyword}{typedef} \mbox{\hyperlink{classEigen_1_1internal_1_1const__blas__data__mapper}{const\_blas\_data\_mapper<Scalar, Index, TriStorageOrder>}} TriMapper;}
\DoxyCodeLine{59     \textcolor{keyword}{typedef} \mbox{\hyperlink{classEigen_1_1internal_1_1blas__data__mapper}{blas\_data\_mapper<Scalar, Index, ColMajor, Unaligned, OtherInnerStride>}} OtherMapper;}
\DoxyCodeLine{60     TriMapper tri(\_tri, triStride);}
\DoxyCodeLine{61     OtherMapper other(\_other, otherStride, otherIncr);}
\DoxyCodeLine{62 }
\DoxyCodeLine{63     \textcolor{keyword}{typedef} \mbox{\hyperlink{classEigen_1_1internal_1_1gebp__traits}{gebp\_traits<Scalar,Scalar>}} Traits;}
\DoxyCodeLine{64 }
\DoxyCodeLine{65     \textcolor{keyword}{enum} \{}
\DoxyCodeLine{66       SmallPanelWidth   = EIGEN\_PLAIN\_ENUM\_MAX(Traits::mr,Traits::nr),}
\DoxyCodeLine{67       IsLower = (Mode\&\mbox{\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaf581029282d421eee5aae14238c6f749}{Lower}}) == \mbox{\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaf581029282d421eee5aae14238c6f749}{Lower}}}
\DoxyCodeLine{68     \};}
\DoxyCodeLine{69 }
\DoxyCodeLine{70     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} kc = blocking.kc();                   \textcolor{comment}{// cache block size along the K direction}}
\DoxyCodeLine{71     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} mc = (std::min)(size,blocking.mc());  \textcolor{comment}{// cache block size along the M direction}}
\DoxyCodeLine{72 }
\DoxyCodeLine{73     std::size\_t sizeA = kc*mc;}
\DoxyCodeLine{74     std::size\_t sizeB = kc*cols;}
\DoxyCodeLine{75 }
\DoxyCodeLine{76     ei\_declare\_aligned\_stack\_constructed\_variable(Scalar, blockA, sizeA, blocking.blockA());}
\DoxyCodeLine{77     ei\_declare\_aligned\_stack\_constructed\_variable(Scalar, blockB, sizeB, blocking.blockB());}
\DoxyCodeLine{78 }
\DoxyCodeLine{79     conj\_if<Conjugate> conj;}
\DoxyCodeLine{80     gebp\_kernel<Scalar, Scalar, Index, OtherMapper, Traits::mr, Traits::nr, Conjugate, false> gebp\_kernel;}
\DoxyCodeLine{81     gemm\_pack\_lhs<Scalar, Index, TriMapper, Traits::mr, Traits::LhsProgress, typename Traits::LhsPacket4Packing, TriStorageOrder> pack\_lhs;}
\DoxyCodeLine{82     gemm\_pack\_rhs<Scalar, Index, OtherMapper, Traits::nr, ColMajor, false, true> pack\_rhs;}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     \textcolor{comment}{// the goal here is to subdivise the Rhs panels such that we keep some cache}}
\DoxyCodeLine{85     \textcolor{comment}{// coherence when accessing the rhs elements}}
\DoxyCodeLine{86     std::ptrdiff\_t l1, l2, l3;}
\DoxyCodeLine{87     manage\_caching\_sizes(GetAction, \&l1, \&l2, \&l3);}
\DoxyCodeLine{88     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} subcols = cols>0 ? l2/(4 * \textcolor{keyword}{sizeof}(Scalar) * std::max<Index>(otherStride,size)) : 0;}
\DoxyCodeLine{89     subcols = std::max<Index>((subcols/Traits::nr)*Traits::nr, Traits::nr);}
\DoxyCodeLine{90 }
\DoxyCodeLine{91     \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} k2=IsLower ? 0 : size;}
\DoxyCodeLine{92         IsLower ? k2<size : k2>0;}
\DoxyCodeLine{93         IsLower ? k2+=kc : k2-\/=kc)}
\DoxyCodeLine{94     \{}
\DoxyCodeLine{95       \textcolor{keyword}{const} \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} actual\_kc = (std::min)(IsLower ? size-\/k2 : k2, kc);}
\DoxyCodeLine{96 }
\DoxyCodeLine{97       \textcolor{comment}{// We have selected and packed a big horizontal panel R1 of rhs. Let B be the packed copy of this panel,}}
\DoxyCodeLine{98       \textcolor{comment}{// and R2 the remaining part of rhs. The corresponding vertical panel of lhs is split into}}
\DoxyCodeLine{99       \textcolor{comment}{// A11 (the triangular part) and A21 the remaining rectangular part.}}
\DoxyCodeLine{100       \textcolor{comment}{// Then the high level algorithm is:}}
\DoxyCodeLine{101       \textcolor{comment}{//  -\/ B = R1                    => general block copy (done during the next step)}}
\DoxyCodeLine{102       \textcolor{comment}{//  -\/ R1 = A11\string^-\/1 B             => tricky part}}
\DoxyCodeLine{103       \textcolor{comment}{//  -\/ update B from the new R1  => actually this has to be performed continuously during the above step}}
\DoxyCodeLine{104       \textcolor{comment}{//  -\/ R2 -\/= A21 * B             => GEPP}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106       \textcolor{comment}{// The tricky part: compute R1 = A11\string^-\/1 B while updating B from R1}}
\DoxyCodeLine{107       \textcolor{comment}{// The idea is to split A11 into multiple small vertical panels.}}
\DoxyCodeLine{108       \textcolor{comment}{// Each panel can be split into a small triangular part T1k which is processed without optimization,}}
\DoxyCodeLine{109       \textcolor{comment}{// and the remaining small part T2k which is processed using gebp with appropriate block strides}}
\DoxyCodeLine{110       \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} j2=0; j2<cols; j2+=subcols)}
\DoxyCodeLine{111       \{}
\DoxyCodeLine{112         \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} actual\_cols = (std::min)(cols-\/j2,subcols);}
\DoxyCodeLine{113         \textcolor{comment}{// for each small vertical panels [T1k\string^T, T2k\string^T]\string^T of lhs}}
\DoxyCodeLine{114         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} k1=0; k1<actual\_kc; k1+=SmallPanelWidth)}
\DoxyCodeLine{115         \{}
\DoxyCodeLine{116           \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} actualPanelWidth = std::min<Index>(actual\_kc-\/k1, SmallPanelWidth);}
\DoxyCodeLine{117           \textcolor{comment}{// tr solve}}
\DoxyCodeLine{118           \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} k=0; k<actualPanelWidth; ++k)}
\DoxyCodeLine{119           \{}
\DoxyCodeLine{120             \textcolor{comment}{// TODO write a small kernel handling this (can be shared with trsv)}}
\DoxyCodeLine{121             \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} i  = IsLower ? k2+k1+k : k2-\/k1-\/k-\/1;}
\DoxyCodeLine{122             \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} rs = actualPanelWidth -\/ k -\/ 1; \textcolor{comment}{// remaining size}}
\DoxyCodeLine{123             \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} s  = TriStorageOrder==\mbox{\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a77c993a8d9f6efe5c1159fb2ab07dd4f}{RowMajor}} ? (IsLower ? k2+k1 : i+1)}
\DoxyCodeLine{124                                                  :  IsLower ? i+1 : i-\/rs;}
\DoxyCodeLine{125 }
\DoxyCodeLine{126             Scalar a = (Mode \& \mbox{\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda2ef430bff6cc12c2d1e0ef01b95f7ff3}{UnitDiag}}) ? Scalar(1) : Scalar(1)/conj(tri(i,i));}
\DoxyCodeLine{127             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} j=j2; j<j2+actual\_cols; ++j)}
\DoxyCodeLine{128             \{}
\DoxyCodeLine{129               \textcolor{keywordflow}{if} (TriStorageOrder==\mbox{\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a77c993a8d9f6efe5c1159fb2ab07dd4f}{RowMajor}})}
\DoxyCodeLine{130               \{}
\DoxyCodeLine{131                 Scalar b(0);}
\DoxyCodeLine{132                 \textcolor{keyword}{const} Scalar* l = \&tri(i,s);}
\DoxyCodeLine{133                 \textcolor{keyword}{typename} OtherMapper::LinearMapper r = other.getLinearMapper(s,j);}
\DoxyCodeLine{134                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} i3=0; i3<k; ++i3)}
\DoxyCodeLine{135                   b += conj(l[i3]) * r(i3);}
\DoxyCodeLine{136 }
\DoxyCodeLine{137                 other(i,j) = (other(i,j) -\/ b)*a;}
\DoxyCodeLine{138               \}}
\DoxyCodeLine{139               \textcolor{keywordflow}{else}}
\DoxyCodeLine{140               \{}
\DoxyCodeLine{141                 Scalar\& otherij = other(i,j);}
\DoxyCodeLine{142                 otherij *= a;}
\DoxyCodeLine{143                 Scalar b = otherij;}
\DoxyCodeLine{144                 \textcolor{keyword}{typename} OtherMapper::LinearMapper r = other.getLinearMapper(s,j);}
\DoxyCodeLine{145                 \textcolor{keyword}{typename} TriMapper::LinearMapper l = tri.getLinearMapper(s,i);}
\DoxyCodeLine{146                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} i3=0;i3<rs;++i3)}
\DoxyCodeLine{147                   r(i3) -\/= b * conj(l(i3));}
\DoxyCodeLine{148               \}}
\DoxyCodeLine{149             \}}
\DoxyCodeLine{150           \}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152           \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} lengthTarget = actual\_kc-\/k1-\/actualPanelWidth;}
\DoxyCodeLine{153           \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} startBlock   = IsLower ? k2+k1 : k2-\/k1-\/actualPanelWidth;}
\DoxyCodeLine{154           \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} blockBOffset = IsLower ? k1 : lengthTarget;}
\DoxyCodeLine{155 }
\DoxyCodeLine{156           \textcolor{comment}{// update the respective rows of B from other}}
\DoxyCodeLine{157           pack\_rhs(blockB+actual\_kc*j2, other.getSubMapper(startBlock,j2), actualPanelWidth, actual\_cols, actual\_kc, blockBOffset);}
\DoxyCodeLine{158 }
\DoxyCodeLine{159           \textcolor{comment}{// GEBP}}
\DoxyCodeLine{160           \textcolor{keywordflow}{if} (lengthTarget>0)}
\DoxyCodeLine{161           \{}
\DoxyCodeLine{162             \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} startTarget  = IsLower ? k2+k1+actualPanelWidth : k2-\/actual\_kc;}
\DoxyCodeLine{163 }
\DoxyCodeLine{164             pack\_lhs(blockA, tri.getSubMapper(startTarget,startBlock), actualPanelWidth, lengthTarget);}
\DoxyCodeLine{165 }
\DoxyCodeLine{166             gebp\_kernel(other.getSubMapper(startTarget,j2), blockA, blockB+actual\_kc*j2, lengthTarget, actualPanelWidth, actual\_cols, Scalar(-\/1),}
\DoxyCodeLine{167                         actualPanelWidth, actual\_kc, 0, blockBOffset);}
\DoxyCodeLine{168           \}}
\DoxyCodeLine{169         \}}
\DoxyCodeLine{170       \}}
\DoxyCodeLine{171       }
\DoxyCodeLine{172       \textcolor{comment}{// R2 -\/= A21 * B => GEPP}}
\DoxyCodeLine{173       \{}
\DoxyCodeLine{174         \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} start = IsLower ? k2+kc : 0;}
\DoxyCodeLine{175         \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} end   = IsLower ? size : k2-\/kc;}
\DoxyCodeLine{176         \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} i2=start; i2<end; i2+=mc)}
\DoxyCodeLine{177         \{}
\DoxyCodeLine{178           \textcolor{keyword}{const} \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} actual\_mc = (std::min)(mc,end-\/i2);}
\DoxyCodeLine{179           \textcolor{keywordflow}{if} (actual\_mc>0)}
\DoxyCodeLine{180           \{}
\DoxyCodeLine{181             pack\_lhs(blockA, tri.getSubMapper(i2, IsLower ? k2 : k2-\/kc), actual\_kc, actual\_mc);}
\DoxyCodeLine{182 }
\DoxyCodeLine{183             gebp\_kernel(other.getSubMapper(i2, 0), blockA, blockB, actual\_mc, actual\_kc, cols, Scalar(-\/1), -\/1, -\/1, 0, 0);}
\DoxyCodeLine{184           \}}
\DoxyCodeLine{185         \}}
\DoxyCodeLine{186       \}}
\DoxyCodeLine{187     \}}
\DoxyCodeLine{188   \}}
\DoxyCodeLine{189 }
\DoxyCodeLine{190 \textcolor{comment}{/* Optimized triangular solver with multiple left hand sides and the triangular matrix on the right}}
\DoxyCodeLine{191 \textcolor{comment}{ */}}
\DoxyCodeLine{192 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar, \textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{bool} Conjugate, \textcolor{keywordtype}{int} TriStorageOrder, \textcolor{keywordtype}{int} OtherInnerStr\textcolor{keywordtype}{id}e>}
\DoxyCodeLine{193 \textcolor{keyword}{struct }\mbox{\hyperlink{structEigen_1_1internal_1_1triangular__solve__matrix}{triangular\_solve\_matrix}}<Scalar,\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}},\mbox{\hyperlink{group__enums_ggac22de43beeac7a78b384f99bed5cee0ba329fc3a54ceb2b6e0e73b400998b8a82}{OnTheRight}},Mode,\mbox{\hyperlink{classEigen_1_1Conjugate}{Conjugate}},TriStorageOrder,\mbox{\hyperlink{group__enums_ggaacded1a18ae58b0f554751f6cdf9eb13a0103672ae41005ab03b4176c765afd62}{ColMajor}},OtherInnerStride>}
\DoxyCodeLine{194 \{}
\DoxyCodeLine{195   \textcolor{keyword}{static} EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} run(}
\DoxyCodeLine{196     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} size, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherSize,}
\DoxyCodeLine{197     \textcolor{keyword}{const} Scalar* \_tri, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} triStride,}
\DoxyCodeLine{198     Scalar* \_other, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherIncr, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherStride,}
\DoxyCodeLine{199     \mbox{\hyperlink{classEigen_1_1internal_1_1level3__blocking}{level3\_blocking<Scalar,Scalar>}}\& blocking);}
\DoxyCodeLine{200 \};}
\DoxyCodeLine{201 \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar, \textcolor{keyword}{typename} Index, \textcolor{keywordtype}{int} Mode, \textcolor{keywordtype}{bool} Conjugate, \textcolor{keywordtype}{int} TriStorageOrder, \textcolor{keywordtype}{int} OtherInnerStr\textcolor{keywordtype}{id}e>}
\DoxyCodeLine{202 EIGEN\_DONT\_INLINE \textcolor{keywordtype}{void} \mbox{\hyperlink{structEigen_1_1internal_1_1triangular__solve__matrix}{triangular\_solve\_matrix<Scalar,Index,OnTheRight,Mode,Conjugate,TriStorageOrder,ColMajor,OtherInnerStride>::run}}(}
\DoxyCodeLine{203     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} size, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherSize,}
\DoxyCodeLine{204     \textcolor{keyword}{const} Scalar* \_tri, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} triStride,}
\DoxyCodeLine{205     Scalar* \_other, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherIncr, \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} otherStride,}
\DoxyCodeLine{206     \mbox{\hyperlink{classEigen_1_1internal_1_1level3__blocking}{level3\_blocking<Scalar,Scalar>}}\& blocking)}
\DoxyCodeLine{207   \{}
\DoxyCodeLine{208     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} rows = otherSize;}
\DoxyCodeLine{209     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \mbox{\hyperlink{structEigen_1_1NumTraits}{NumTraits<Scalar>::Real}} RealScalar;}
\DoxyCodeLine{210 }
\DoxyCodeLine{211     \textcolor{keyword}{typedef} \mbox{\hyperlink{classEigen_1_1internal_1_1blas__data__mapper}{blas\_data\_mapper<Scalar, Index, ColMajor, Unaligned, OtherInnerStride>}} LhsMapper;}
\DoxyCodeLine{212     \textcolor{keyword}{typedef} \mbox{\hyperlink{classEigen_1_1internal_1_1const__blas__data__mapper}{const\_blas\_data\_mapper<Scalar, Index, TriStorageOrder>}} RhsMapper;}
\DoxyCodeLine{213     LhsMapper lhs(\_other, otherStride, otherIncr);}
\DoxyCodeLine{214     RhsMapper rhs(\_tri, triStride);}
\DoxyCodeLine{215 }
\DoxyCodeLine{216     \textcolor{keyword}{typedef} \mbox{\hyperlink{classEigen_1_1internal_1_1gebp__traits}{gebp\_traits<Scalar,Scalar>}} Traits;}
\DoxyCodeLine{217     \textcolor{keyword}{enum} \{}
\DoxyCodeLine{218       RhsStorageOrder   = TriStorageOrder,}
\DoxyCodeLine{219       SmallPanelWidth   = EIGEN\_PLAIN\_ENUM\_MAX(Traits::mr,Traits::nr),}
\DoxyCodeLine{220       IsLower = (Mode\&\mbox{\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaf581029282d421eee5aae14238c6f749}{Lower}}) == \mbox{\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cdaf581029282d421eee5aae14238c6f749}{Lower}}}
\DoxyCodeLine{221     \};}
\DoxyCodeLine{222 }
\DoxyCodeLine{223     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} kc = blocking.kc();                   \textcolor{comment}{// cache block size along the K direction}}
\DoxyCodeLine{224     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} mc = (std::min)(rows,blocking.mc());  \textcolor{comment}{// cache block size along the M direction}}
\DoxyCodeLine{225 }
\DoxyCodeLine{226     std::size\_t sizeA = kc*mc;}
\DoxyCodeLine{227     std::size\_t sizeB = kc*size;}
\DoxyCodeLine{228 }
\DoxyCodeLine{229     ei\_declare\_aligned\_stack\_constructed\_variable(Scalar, blockA, sizeA, blocking.blockA());}
\DoxyCodeLine{230     ei\_declare\_aligned\_stack\_constructed\_variable(Scalar, blockB, sizeB, blocking.blockB());}
\DoxyCodeLine{231 }
\DoxyCodeLine{232     conj\_if<Conjugate> conj;}
\DoxyCodeLine{233     gebp\_kernel<Scalar, Scalar, Index, LhsMapper, Traits::mr, Traits::nr, false, Conjugate> gebp\_kernel;}
\DoxyCodeLine{234     gemm\_pack\_rhs<Scalar, Index, RhsMapper, Traits::nr, RhsStorageOrder> pack\_rhs;}
\DoxyCodeLine{235     gemm\_pack\_rhs<Scalar, Index, RhsMapper, Traits::nr, RhsStorageOrder,false,true> pack\_rhs\_panel;}
\DoxyCodeLine{236     gemm\_pack\_lhs<Scalar, Index, LhsMapper, Traits::mr, Traits::LhsProgress, typename Traits::LhsPacket4Packing, ColMajor, false, true> pack\_lhs\_panel;}
\DoxyCodeLine{237 }
\DoxyCodeLine{238     \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} k2=IsLower ? size : 0;}
\DoxyCodeLine{239         IsLower ? k2>0 : k2<size;}
\DoxyCodeLine{240         IsLower ? k2-\/=kc : k2+=kc)}
\DoxyCodeLine{241     \{}
\DoxyCodeLine{242       \textcolor{keyword}{const} \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} actual\_kc = (std::min)(IsLower ? k2 : size-\/k2, kc);}
\DoxyCodeLine{243       \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} actual\_k2 = IsLower ? k2-\/actual\_kc : k2 ;}
\DoxyCodeLine{244 }
\DoxyCodeLine{245       \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} startPanel = IsLower ? 0 : k2+actual\_kc;}
\DoxyCodeLine{246       \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} rs = IsLower ? actual\_k2 : size -\/ actual\_k2 -\/ actual\_kc;}
\DoxyCodeLine{247       Scalar* geb = blockB+actual\_kc*actual\_kc;}
\DoxyCodeLine{248 }
\DoxyCodeLine{249       \textcolor{keywordflow}{if} (rs>0) pack\_rhs(geb, rhs.getSubMapper(actual\_k2,startPanel), actual\_kc, rs);}
\DoxyCodeLine{250 }
\DoxyCodeLine{251       \textcolor{comment}{// triangular packing (we only pack the panels off the diagonal,}}
\DoxyCodeLine{252       \textcolor{comment}{// neglecting the blocks overlapping the diagonal}}
\DoxyCodeLine{253       \{}
\DoxyCodeLine{254         \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} j2=0; j2<actual\_kc; j2+=SmallPanelWidth)}
\DoxyCodeLine{255         \{}
\DoxyCodeLine{256           \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} actualPanelWidth = std::min<Index>(actual\_kc-\/j2, SmallPanelWidth);}
\DoxyCodeLine{257           \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} actual\_j2 = actual\_k2 + j2;}
\DoxyCodeLine{258           \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} panelOffset = IsLower ? j2+actualPanelWidth : 0;}
\DoxyCodeLine{259           \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} panelLength = IsLower ? actual\_kc-\/j2-\/actualPanelWidth : j2;}
\DoxyCodeLine{260 }
\DoxyCodeLine{261           \textcolor{keywordflow}{if} (panelLength>0)}
\DoxyCodeLine{262           pack\_rhs\_panel(blockB+j2*actual\_kc,}
\DoxyCodeLine{263                          rhs.getSubMapper(actual\_k2+panelOffset, actual\_j2),}
\DoxyCodeLine{264                          panelLength, actualPanelWidth,}
\DoxyCodeLine{265                          actual\_kc, panelOffset);}
\DoxyCodeLine{266         \}}
\DoxyCodeLine{267       \}}
\DoxyCodeLine{268 }
\DoxyCodeLine{269       \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} i2=0; i2<rows; i2+=mc)}
\DoxyCodeLine{270       \{}
\DoxyCodeLine{271         \textcolor{keyword}{const} \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} actual\_mc = (std::min)(mc,rows-\/i2);}
\DoxyCodeLine{272 }
\DoxyCodeLine{273         \textcolor{comment}{// triangular solver kernel}}
\DoxyCodeLine{274         \{}
\DoxyCodeLine{275           \textcolor{comment}{// for each small block of the diagonal (=> vertical panels of rhs)}}
\DoxyCodeLine{276           \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} j2 = IsLower}
\DoxyCodeLine{277                       ? (actual\_kc -\/ ((actual\_kc\%SmallPanelWidth) ? \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}(actual\_kc\%SmallPanelWidth)}
\DoxyCodeLine{278                                                                   : \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}}(SmallPanelWidth)))}
\DoxyCodeLine{279                       : 0;}
\DoxyCodeLine{280                IsLower ? j2>=0 : j2<actual\_kc;}
\DoxyCodeLine{281                IsLower ? j2-\/=SmallPanelWidth : j2+=SmallPanelWidth)}
\DoxyCodeLine{282           \{}
\DoxyCodeLine{283             \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} actualPanelWidth = std::min<Index>(actual\_kc-\/j2, SmallPanelWidth);}
\DoxyCodeLine{284             \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} absolute\_j2 = actual\_k2 + j2;}
\DoxyCodeLine{285             \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} panelOffset = IsLower ? j2+actualPanelWidth : 0;}
\DoxyCodeLine{286             \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} panelLength = IsLower ? actual\_kc -\/ j2 -\/ actualPanelWidth : j2;}
\DoxyCodeLine{287 }
\DoxyCodeLine{288             \textcolor{comment}{// GEBP}}
\DoxyCodeLine{289             \textcolor{keywordflow}{if}(panelLength>0)}
\DoxyCodeLine{290             \{}
\DoxyCodeLine{291               gebp\_kernel(lhs.getSubMapper(i2,absolute\_j2),}
\DoxyCodeLine{292                           blockA, blockB+j2*actual\_kc,}
\DoxyCodeLine{293                           actual\_mc, panelLength, actualPanelWidth,}
\DoxyCodeLine{294                           Scalar(-\/1),}
\DoxyCodeLine{295                           actual\_kc, actual\_kc, \textcolor{comment}{// strides}}
\DoxyCodeLine{296                           panelOffset, panelOffset); \textcolor{comment}{// offsets}}
\DoxyCodeLine{297             \}}
\DoxyCodeLine{298 }
\DoxyCodeLine{299             \textcolor{comment}{// unblocked triangular solve}}
\DoxyCodeLine{300             \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} k=0; k<actualPanelWidth; ++k)}
\DoxyCodeLine{301             \{}
\DoxyCodeLine{302               \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} j = IsLower ? absolute\_j2+actualPanelWidth-\/k-\/1 : absolute\_j2+k;}
\DoxyCodeLine{303 }
\DoxyCodeLine{304               \textcolor{keyword}{typename} LhsMapper::LinearMapper r = lhs.getLinearMapper(i2,j);}
\DoxyCodeLine{305               \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} k3=0; k3<k; ++k3)}
\DoxyCodeLine{306               \{}
\DoxyCodeLine{307                 Scalar b = conj(rhs(IsLower ? j+1+k3 : absolute\_j2+k3,j));}
\DoxyCodeLine{308                 \textcolor{keyword}{typename} LhsMapper::LinearMapper a = lhs.getLinearMapper(i2,IsLower ? j+1+k3 : absolute\_j2+k3);}
\DoxyCodeLine{309                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} i=0; i<actual\_mc; ++i)}
\DoxyCodeLine{310                   r(i) -\/= a(i) * b;}
\DoxyCodeLine{311               \}}
\DoxyCodeLine{312               \textcolor{keywordflow}{if}((Mode \& \mbox{\hyperlink{group__enums_gga39e3366ff5554d731e7dc8bb642f83cda2ef430bff6cc12c2d1e0ef01b95f7ff3}{UnitDiag}})==0)}
\DoxyCodeLine{313               \{}
\DoxyCodeLine{314                 Scalar inv\_rjj = RealScalar(1)/conj(rhs(j,j));}
\DoxyCodeLine{315                 \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} i=0; i<actual\_mc; ++i)}
\DoxyCodeLine{316                   r(i) *= inv\_rjj;}
\DoxyCodeLine{317               \}}
\DoxyCodeLine{318             \}}
\DoxyCodeLine{319 }
\DoxyCodeLine{320             \textcolor{comment}{// pack the just computed part of lhs to A}}
\DoxyCodeLine{321             pack\_lhs\_panel(blockA, lhs.getSubMapper(i2,absolute\_j2),}
\DoxyCodeLine{322                            actualPanelWidth, actual\_mc,}
\DoxyCodeLine{323                            actual\_kc, j2);}
\DoxyCodeLine{324           \}}
\DoxyCodeLine{325         \}}
\DoxyCodeLine{326 }
\DoxyCodeLine{327         \textcolor{keywordflow}{if} (rs>0)}
\DoxyCodeLine{328           gebp\_kernel(lhs.getSubMapper(i2, startPanel), blockA, geb,}
\DoxyCodeLine{329                       actual\_mc, actual\_kc, rs, Scalar(-\/1),}
\DoxyCodeLine{330                       -\/1, -\/1, 0, 0);}
\DoxyCodeLine{331       \}}
\DoxyCodeLine{332     \}}
\DoxyCodeLine{333   \}}
\DoxyCodeLine{334 }
\DoxyCodeLine{335 \} \textcolor{comment}{// end namespace internal}}
\DoxyCodeLine{336 }
\DoxyCodeLine{337 \} \textcolor{comment}{// end namespace Eigen}}
\DoxyCodeLine{338 }
\DoxyCodeLine{339 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// EIGEN\_TRIANGULAR\_SOLVER\_MATRIX\_H}}

\end{DoxyCode}
