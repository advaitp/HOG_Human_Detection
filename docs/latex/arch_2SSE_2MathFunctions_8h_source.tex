\hypertarget{arch_2SSE_2MathFunctions_8h_source}{}\doxysection{Math\+Functions.\+h}
\label{arch_2SSE_2MathFunctions_8h_source}\index{include/Eigen/src/Core/arch/SSE/MathFunctions.h@{include/Eigen/src/Core/arch/SSE/MathFunctions.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}}
\DoxyCodeLine{2 \textcolor{comment}{// for linear algebra.}}
\DoxyCodeLine{3 \textcolor{comment}{//}}
\DoxyCodeLine{4 \textcolor{comment}{// Copyright (C) 2007 Julien Pommier}}
\DoxyCodeLine{5 \textcolor{comment}{// Copyright (C) 2009 Gael Guennebaud <gael.guennebaud@inria.fr>}}
\DoxyCodeLine{6 \textcolor{comment}{//}}
\DoxyCodeLine{7 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}}
\DoxyCodeLine{8 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}}
\DoxyCodeLine{9 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{/* The sin and cos and functions of this file come from}}
\DoxyCodeLine{12 \textcolor{comment}{ * Julien Pommier's sse math library: http://gruntthepeon.free.fr/ssemath/}}
\DoxyCodeLine{13 \textcolor{comment}{ */}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#ifndef EIGEN\_MATH\_FUNCTIONS\_SSE\_H}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#define EIGEN\_MATH\_FUNCTIONS\_SSE\_H}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include "{}../../InternalHeaderCheck.h"{}}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceEigen}{Eigen}} \{}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{keyword}{namespace }internal \{}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{25 Packet4f plog<Packet4f>(\textcolor{keyword}{const} Packet4f\& \_x) \{}
\DoxyCodeLine{26   \textcolor{keywordflow}{return} plog\_float(\_x);}
\DoxyCodeLine{27 \}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{30 Packet2d plog<Packet2d>(\textcolor{keyword}{const} Packet2d\& \_x) \{}
\DoxyCodeLine{31   \textcolor{keywordflow}{return} plog\_double(\_x);}
\DoxyCodeLine{32 \}}
\DoxyCodeLine{33 }
\DoxyCodeLine{34 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{35 Packet4f plog2<Packet4f>(\textcolor{keyword}{const} Packet4f\& \_x) \{}
\DoxyCodeLine{36   \textcolor{keywordflow}{return} plog2\_float(\_x);}
\DoxyCodeLine{37 \}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{40 Packet2d plog2<Packet2d>(\textcolor{keyword}{const} Packet2d\& \_x) \{}
\DoxyCodeLine{41   \textcolor{keywordflow}{return} plog2\_double(\_x);}
\DoxyCodeLine{42 \}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{45 Packet4f plog1p<Packet4f>(\textcolor{keyword}{const} Packet4f\& \_x) \{}
\DoxyCodeLine{46   \textcolor{keywordflow}{return} generic\_plog1p(\_x);}
\DoxyCodeLine{47 \}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{50 Packet4f pexpm1<Packet4f>(\textcolor{keyword}{const} Packet4f\& \_x) \{}
\DoxyCodeLine{51   \textcolor{keywordflow}{return} generic\_expm1(\_x);}
\DoxyCodeLine{52 \}}
\DoxyCodeLine{53 }
\DoxyCodeLine{54 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{55 Packet4f pexp<Packet4f>(\textcolor{keyword}{const} Packet4f\& \_x)}
\DoxyCodeLine{56 \{}
\DoxyCodeLine{57   \textcolor{keywordflow}{return} pexp\_float(\_x);}
\DoxyCodeLine{58 \}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{61 Packet2d pexp<Packet2d>(\textcolor{keyword}{const} Packet2d\& x)}
\DoxyCodeLine{62 \{}
\DoxyCodeLine{63   \textcolor{keywordflow}{return} pexp\_double(x);}
\DoxyCodeLine{64 \}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{67 Packet4f psin<Packet4f>(\textcolor{keyword}{const} Packet4f\& \_x)}
\DoxyCodeLine{68 \{}
\DoxyCodeLine{69   \textcolor{keywordflow}{return} psin\_float(\_x);}
\DoxyCodeLine{70 \}}
\DoxyCodeLine{71 }
\DoxyCodeLine{72 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{73 Packet4f pcos<Packet4f>(\textcolor{keyword}{const} Packet4f\& \_x)}
\DoxyCodeLine{74 \{}
\DoxyCodeLine{75   \textcolor{keywordflow}{return} pcos\_float(\_x);}
\DoxyCodeLine{76 \}}
\DoxyCodeLine{77 }
\DoxyCodeLine{78 \textcolor{preprocessor}{\#if EIGEN\_FAST\_MATH}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80 \textcolor{comment}{// Functions for sqrt.}}
\DoxyCodeLine{81 \textcolor{comment}{// The EIGEN\_FAST\_MATH version uses the \_mm\_rsqrt\_ps approximation and one step}}
\DoxyCodeLine{82 \textcolor{comment}{// of Newton's method, at a cost of 1-\/2 bits of precision as opposed to the}}
\DoxyCodeLine{83 \textcolor{comment}{// exact solution. It does not handle +inf, or denormalized numbers correctly.}}
\DoxyCodeLine{84 \textcolor{comment}{// The main advantage of this approach is not just speed, but also the fact that}}
\DoxyCodeLine{85 \textcolor{comment}{// it can be inlined and pipelined with other computations, further reducing its}}
\DoxyCodeLine{86 \textcolor{comment}{// effective latency. This is similar to Quake3's fast inverse square root.}}
\DoxyCodeLine{87 \textcolor{comment}{// For detail see here: http://www.beyond3d.com/content/articles/8/}}
\DoxyCodeLine{88 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{89 Packet4f psqrt<Packet4f>(\textcolor{keyword}{const} Packet4f\& \_x)}
\DoxyCodeLine{90 \{}
\DoxyCodeLine{91   Packet4f minus\_half\_x = pmul(\_x, pset1<Packet4f>(-\/0.5f));}
\DoxyCodeLine{92   Packet4f denormal\_mask = pandnot(}
\DoxyCodeLine{93       pcmp\_lt(\_x, pset1<Packet4f>((std::numeric\_limits<float>::min)())),}
\DoxyCodeLine{94       pcmp\_lt(\_x, pzero(\_x)));}
\DoxyCodeLine{95 }
\DoxyCodeLine{96   \textcolor{comment}{// Compute approximate reciprocal sqrt.}}
\DoxyCodeLine{97   Packet4f x = \_mm\_rsqrt\_ps(\_x);}
\DoxyCodeLine{98   \textcolor{comment}{// Do a single step of Newton's iteration.}}
\DoxyCodeLine{99   x = pmul(x, pmadd(minus\_half\_x, pmul(x,x), pset1<Packet4f>(1.5f)));}
\DoxyCodeLine{100   \textcolor{comment}{// Flush results for denormals to zero.}}
\DoxyCodeLine{101   \textcolor{keywordflow}{return} pandnot(pmul(\_x,x), denormal\_mask);}
\DoxyCodeLine{102 \}}
\DoxyCodeLine{103 }
\DoxyCodeLine{104 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106 \textcolor{keyword}{template}<>EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{107 Packet4f psqrt<Packet4f>(\textcolor{keyword}{const} Packet4f\& x) \{ \textcolor{keywordflow}{return} \_mm\_sqrt\_ps(x); \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{110 }
\DoxyCodeLine{111 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{112 Packet2d psqrt<Packet2d>(\textcolor{keyword}{const} Packet2d\& x) \{ \textcolor{keywordflow}{return} \_mm\_sqrt\_pd(x); \}}
\DoxyCodeLine{113 }
\DoxyCodeLine{114 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{115 Packet16b psqrt<Packet16b>(\textcolor{keyword}{const} Packet16b\& x) \{ \textcolor{keywordflow}{return} x; \}}
\DoxyCodeLine{116 }
\DoxyCodeLine{117 \textcolor{preprocessor}{\#if EIGEN\_FAST\_MATH}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{120 Packet4f prsqrt<Packet4f>(\textcolor{keyword}{const} Packet4f\& \_x) \{}
\DoxyCodeLine{121   \_EIGEN\_DECLARE\_CONST\_Packet4f(one\_point\_five, 1.5f);}
\DoxyCodeLine{122   \_EIGEN\_DECLARE\_CONST\_Packet4f(minus\_half, -\/0.5f);}
\DoxyCodeLine{123   \_EIGEN\_DECLARE\_CONST\_Packet4f\_FROM\_INT(inf, 0x7f800000u);}
\DoxyCodeLine{124   \_EIGEN\_DECLARE\_CONST\_Packet4f\_FROM\_INT(flt\_min, 0x00800000u);}
\DoxyCodeLine{125 }
\DoxyCodeLine{126   Packet4f neg\_half = pmul(\_x, p4f\_minus\_half);}
\DoxyCodeLine{127 }
\DoxyCodeLine{128   \textcolor{comment}{// Identity infinite, zero, negative and denormal arguments.}}
\DoxyCodeLine{129   Packet4f lt\_min\_mask = \_mm\_cmplt\_ps(\_x, p4f\_flt\_min);}
\DoxyCodeLine{130   Packet4f inf\_mask = \_mm\_cmpeq\_ps(\_x, p4f\_inf);}
\DoxyCodeLine{131   Packet4f not\_normal\_finite\_mask = \_mm\_or\_ps(lt\_min\_mask, inf\_mask);}
\DoxyCodeLine{132 }
\DoxyCodeLine{133   \textcolor{comment}{// Compute an approximate result using the rsqrt intrinsic.}}
\DoxyCodeLine{134   Packet4f y\_approx = \_mm\_rsqrt\_ps(\_x);}
\DoxyCodeLine{135 }
\DoxyCodeLine{136   \textcolor{comment}{// Do a single step of Newton-\/Raphson iteration to improve the approximation.}}
\DoxyCodeLine{137   \textcolor{comment}{// This uses the formula y\_\{n+1\} = y\_n * (1.5 -\/ y\_n * (0.5 * x) * y\_n).}}
\DoxyCodeLine{138   \textcolor{comment}{// It is essential to evaluate the inner term like this because forming}}
\DoxyCodeLine{139   \textcolor{comment}{// y\_n\string^2 may over-\/ or underflow.}}
\DoxyCodeLine{140   Packet4f y\_newton = pmul(}
\DoxyCodeLine{141       y\_approx, pmadd(y\_approx, pmul(neg\_half, y\_approx), p4f\_one\_point\_five));}
\DoxyCodeLine{142 }
\DoxyCodeLine{143   \textcolor{comment}{// Select the result of the Newton-\/Raphson step for positive normal arguments.}}
\DoxyCodeLine{144   \textcolor{comment}{// For other arguments, choose the output of the intrinsic. This will}}
\DoxyCodeLine{145   \textcolor{comment}{// return rsqrt(+inf) = 0, rsqrt(x) = NaN if x < 0, and rsqrt(x) = +inf if}}
\DoxyCodeLine{146   \textcolor{comment}{// x is zero or a positive denormalized float (equivalent to flushing positive}}
\DoxyCodeLine{147   \textcolor{comment}{// denormalized inputs to zero).}}
\DoxyCodeLine{148   \textcolor{keywordflow}{return} pselect<Packet4f>(not\_normal\_finite\_mask, y\_approx, y\_newton);}
\DoxyCodeLine{149 \}}
\DoxyCodeLine{150 }
\DoxyCodeLine{151 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{152 }
\DoxyCodeLine{153 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{154 Packet4f prsqrt<Packet4f>(\textcolor{keyword}{const} Packet4f\& x) \{}
\DoxyCodeLine{155   \textcolor{comment}{// Unfortunately we can't use the much faster mm\_rsqrt\_ps since it only provides an approximation.}}
\DoxyCodeLine{156   \textcolor{keywordflow}{return} \_mm\_div\_ps(pset1<Packet4f>(1.0f), \_mm\_sqrt\_ps(x));}
\DoxyCodeLine{157 \}}
\DoxyCodeLine{158 }
\DoxyCodeLine{159 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{160 }
\DoxyCodeLine{161 \textcolor{keyword}{template}<> EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED}
\DoxyCodeLine{162 Packet2d prsqrt<Packet2d>(\textcolor{keyword}{const} Packet2d\& x) \{}
\DoxyCodeLine{163   \textcolor{keywordflow}{return} \_mm\_div\_pd(pset1<Packet2d>(1.0), \_mm\_sqrt\_pd(x));}
\DoxyCodeLine{164 \}}
\DoxyCodeLine{165 }
\DoxyCodeLine{166 \textcolor{comment}{// Hyperbolic Tangent function.}}
\DoxyCodeLine{167 \textcolor{keyword}{template} <>}
\DoxyCodeLine{168 EIGEN\_DEFINE\_FUNCTION\_ALLOWING\_MULTIPLE\_DEFINITIONS EIGEN\_UNUSED Packet4f}
\DoxyCodeLine{169 ptanh<Packet4f>(\textcolor{keyword}{const} Packet4f\& x) \{}
\DoxyCodeLine{170   \textcolor{keywordflow}{return} internal::generic\_fast\_tanh\_float(x);}
\DoxyCodeLine{171 \}}
\DoxyCodeLine{172 }
\DoxyCodeLine{173 \} \textcolor{comment}{// end namespace internal}}
\DoxyCodeLine{174 }
\DoxyCodeLine{175 \textcolor{keyword}{namespace }numext \{}
\DoxyCodeLine{176 }
\DoxyCodeLine{177 \textcolor{keyword}{template}<>}
\DoxyCodeLine{178 EIGEN\_DEVICE\_FUNC EIGEN\_ALWAYS\_INLINE}
\DoxyCodeLine{179 \textcolor{keywordtype}{float} sqrt(\textcolor{keyword}{const} \textcolor{keywordtype}{float} \&x)}
\DoxyCodeLine{180 \{}
\DoxyCodeLine{181   \textcolor{keywordflow}{return} internal::pfirst(internal::Packet4f(\_mm\_sqrt\_ss(\_mm\_set\_ss(x))));}
\DoxyCodeLine{182 \}}
\DoxyCodeLine{183 }
\DoxyCodeLine{184 \textcolor{keyword}{template}<>}
\DoxyCodeLine{185 EIGEN\_DEVICE\_FUNC EIGEN\_ALWAYS\_INLINE}
\DoxyCodeLine{186 \textcolor{keywordtype}{double} sqrt(\textcolor{keyword}{const} \textcolor{keywordtype}{double} \&x)}
\DoxyCodeLine{187 \{}
\DoxyCodeLine{188 \textcolor{preprocessor}{\#if EIGEN\_COMP\_GNUC\_STRICT}}
\DoxyCodeLine{189   \textcolor{comment}{// This works around a GCC bug generating poor code for \_mm\_sqrt\_pd}}
\DoxyCodeLine{190   \textcolor{comment}{// See https://gitlab.com/libeigen/eigen/commit/8dca9f97e38970}}
\DoxyCodeLine{191   \textcolor{keywordflow}{return} internal::pfirst(internal::Packet2d(\_\_builtin\_ia32\_sqrtsd(\_mm\_set\_sd(x))));}
\DoxyCodeLine{192 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{193   \textcolor{keywordflow}{return} internal::pfirst(internal::Packet2d(\_mm\_sqrt\_pd(\_mm\_set\_sd(x))));}
\DoxyCodeLine{194 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{195 \}}
\DoxyCodeLine{196 }
\DoxyCodeLine{197 \} \textcolor{comment}{// end namespace numex}}
\DoxyCodeLine{198 }
\DoxyCodeLine{199 \} \textcolor{comment}{// end namespace Eigen}}
\DoxyCodeLine{200 }
\DoxyCodeLine{201 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// EIGEN\_MATH\_FUNCTIONS\_SSE\_H}}

\end{DoxyCode}
