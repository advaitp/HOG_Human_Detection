\hypertarget{ComplexEigenSolver_8h_source}{}\doxysection{Complex\+Eigen\+Solver.\+h}
\label{ComplexEigenSolver_8h_source}\index{include/Eigen/src/Eigenvalues/ComplexEigenSolver.h@{include/Eigen/src/Eigenvalues/ComplexEigenSolver.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// This file is part of Eigen, a lightweight C++ template library}}
\DoxyCodeLine{2 \textcolor{comment}{// for linear algebra.}}
\DoxyCodeLine{3 \textcolor{comment}{//}}
\DoxyCodeLine{4 \textcolor{comment}{// Copyright (C) 2009 Claire Maurice}}
\DoxyCodeLine{5 \textcolor{comment}{// Copyright (C) 2009 Gael Guennebaud <gael.guennebaud@inria.fr>}}
\DoxyCodeLine{6 \textcolor{comment}{// Copyright (C) 2010,2012 Jitse Niesen <jitse@maths.leeds.ac.uk>}}
\DoxyCodeLine{7 \textcolor{comment}{//}}
\DoxyCodeLine{8 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla}}
\DoxyCodeLine{9 \textcolor{comment}{// Public License v. 2.0. If a copy of the MPL was not distributed}}
\DoxyCodeLine{10 \textcolor{comment}{// with this file, You can obtain one at http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#ifndef EIGEN\_COMPLEX\_EIGEN\_SOLVER\_H}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#define EIGEN\_COMPLEX\_EIGEN\_SOLVER\_H}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}./ComplexSchur.h"{}}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}./InternalHeaderCheck.h"{}}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceEigen}{Eigen}} \{ }
\DoxyCodeLine{20 }
\DoxyCodeLine{47 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType\_> \textcolor{keyword}{class }\mbox{\hyperlink{classEigen_1_1ComplexEigenSolver}{ComplexEigenSolver}}}
\DoxyCodeLine{48 \{}
\DoxyCodeLine{49   \textcolor{keyword}{public}:}
\DoxyCodeLine{50 }
\DoxyCodeLine{52     \textcolor{keyword}{typedef} MatrixType\_ \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_ac9cbc46e4029e5270233f2e5935ca7c5}{MatrixType}};}
\DoxyCodeLine{53 }
\DoxyCodeLine{54     \textcolor{keyword}{enum} \{}
\DoxyCodeLine{55       RowsAtCompileTime = MatrixType::RowsAtCompileTime,}
\DoxyCodeLine{56       ColsAtCompileTime = MatrixType::ColsAtCompileTime,}
\DoxyCodeLine{57       Options = MatrixType::Options,}
\DoxyCodeLine{58       MaxRowsAtCompileTime = MatrixType::MaxRowsAtCompileTime,}
\DoxyCodeLine{59       MaxColsAtCompileTime = MatrixType::MaxColsAtCompileTime}
\DoxyCodeLine{60     \};}
\DoxyCodeLine{61 }
\DoxyCodeLine{63     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} MatrixType::Scalar \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a529599511298b96c3aa8c076807adcd9}{Scalar}};}
\DoxyCodeLine{64     \textcolor{keyword}{typedef} \textcolor{keyword}{typename} \mbox{\hyperlink{structEigen_1_1NumTraits}{NumTraits<Scalar>::Real}} RealScalar;}
\DoxyCodeLine{65     \textcolor{keyword}{typedef} \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Eigen::Index}} \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a8bd6f818f11487fa2eb4b01cb920ace6}{Index}}; }
\DoxyCodeLine{66 }
\DoxyCodeLine{73     \textcolor{keyword}{typedef} std::complex<RealScalar> \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a2ac2cfde9d0f3012e059c8d8e2ba7db7}{ComplexScalar}};}
\DoxyCodeLine{74 }
\DoxyCodeLine{80     \textcolor{keyword}{typedef} \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix}}<\mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a2ac2cfde9d0f3012e059c8d8e2ba7db7}{ComplexScalar}}, ColsAtCompileTime, 1, Options\&(\string~RowMajor), MaxColsAtCompileTime, 1> \mbox{\hyperlink{classEigen_1_1Matrix}{EigenvalueType}};}
\DoxyCodeLine{81 }
\DoxyCodeLine{87     \textcolor{keyword}{typedef} \mbox{\hyperlink{classEigen_1_1Matrix}{Matrix<ComplexScalar, RowsAtCompileTime, ColsAtCompileTime, Options, MaxRowsAtCompileTime, MaxColsAtCompileTime>}} \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a8f3a8e3a570ca7e6df9a5ebfaa832d59}{EigenvectorType}};}
\DoxyCodeLine{88 }
\DoxyCodeLine{94     \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a47423d74e9d6d1c1583ddf0d0739c38b}{ComplexEigenSolver}}()}
\DoxyCodeLine{95             : m\_eivec(),}
\DoxyCodeLine{96               m\_eivalues(),}
\DoxyCodeLine{97               m\_schur(),}
\DoxyCodeLine{98               m\_isInitialized(false),}
\DoxyCodeLine{99               m\_eigenvectorsOk(false),}
\DoxyCodeLine{100               m\_matX()}
\DoxyCodeLine{101     \{\}}
\DoxyCodeLine{102 }
\DoxyCodeLine{109     \textcolor{keyword}{explicit} \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a37240ce1bf2092c91d3bcb93ce30d9a9}{ComplexEigenSolver}}(\mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a8bd6f818f11487fa2eb4b01cb920ace6}{Index}} size)}
\DoxyCodeLine{110             : m\_eivec(size, size),}
\DoxyCodeLine{111               m\_eivalues(size),}
\DoxyCodeLine{112               m\_schur(size),}
\DoxyCodeLine{113               m\_isInitialized(false),}
\DoxyCodeLine{114               m\_eigenvectorsOk(false),}
\DoxyCodeLine{115               m\_matX(size, size)}
\DoxyCodeLine{116     \{\}}
\DoxyCodeLine{117 }
\DoxyCodeLine{127     \textcolor{keyword}{template}<\textcolor{keyword}{typename} InputType>}
\DoxyCodeLine{128     \textcolor{keyword}{explicit} \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a6b1ad5564efbd25fc8f8f0321424e821}{ComplexEigenSolver}}(\textcolor{keyword}{const} \mbox{\hyperlink{structEigen_1_1EigenBase}{EigenBase<InputType>}}\& matrix, \textcolor{keywordtype}{bool} computeEigenvectors = \textcolor{keyword}{true})}
\DoxyCodeLine{129             : m\_eivec(matrix.rows(),matrix.cols()),}
\DoxyCodeLine{130               m\_eivalues(matrix.cols()),}
\DoxyCodeLine{131               m\_schur(matrix.rows()),}
\DoxyCodeLine{132               m\_isInitialized(false),}
\DoxyCodeLine{133               m\_eigenvectorsOk(false),}
\DoxyCodeLine{134               m\_matX(matrix.rows(),matrix.cols())}
\DoxyCodeLine{135     \{}
\DoxyCodeLine{136       \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a2209320a0bb39725834c39fd92183cd6}{compute}}(matrix.\mbox{\hyperlink{structEigen_1_1EigenBase_ab4cf3e6bb046a94a46b69b857bd3dbc9}{derived}}(), computeEigenvectors);}
\DoxyCodeLine{137     \}}
\DoxyCodeLine{138 }
\DoxyCodeLine{159     \textcolor{keyword}{const} \mbox{\hyperlink{classEigen_1_1Matrix}{EigenvectorType}}\& \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a8b30e8411ff66aa6441d2519af1a4e06}{eigenvectors}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{160 \textcolor{keyword}{    }\{}
\DoxyCodeLine{161       eigen\_assert(m\_isInitialized \&\& \textcolor{stringliteral}{"{}ComplexEigenSolver is not initialized."{}});}
\DoxyCodeLine{162       eigen\_assert(m\_eigenvectorsOk \&\& \textcolor{stringliteral}{"{}The eigenvectors have not been computed together with the eigenvalues."{}});}
\DoxyCodeLine{163       \textcolor{keywordflow}{return} m\_eivec;}
\DoxyCodeLine{164     \}}
\DoxyCodeLine{165 }
\DoxyCodeLine{184     \textcolor{keyword}{const} \mbox{\hyperlink{classEigen_1_1Matrix}{EigenvalueType}}\& \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_adddc0fe33c0c8648dea752d0f686e513}{eigenvalues}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{185 \textcolor{keyword}{    }\{}
\DoxyCodeLine{186       eigen\_assert(m\_isInitialized \&\& \textcolor{stringliteral}{"{}ComplexEigenSolver is not initialized."{}});}
\DoxyCodeLine{187       \textcolor{keywordflow}{return} m\_eivalues;}
\DoxyCodeLine{188     \}}
\DoxyCodeLine{189 }
\DoxyCodeLine{214     \textcolor{keyword}{template}<\textcolor{keyword}{typename} InputType>}
\DoxyCodeLine{215     \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver}{ComplexEigenSolver}}\& \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a2209320a0bb39725834c39fd92183cd6}{compute}}(\textcolor{keyword}{const} \mbox{\hyperlink{structEigen_1_1EigenBase}{EigenBase<InputType>}}\& matrix, \textcolor{keywordtype}{bool} computeEigenvectors = \textcolor{keyword}{true});}
\DoxyCodeLine{216 }
\DoxyCodeLine{221     \mbox{\hyperlink{group__enums_ga85fad7b87587764e5cf6b513a9e0ee5e}{ComputationInfo}} \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_aee79c3be45f7d1a8f6dcfffc421dca69}{info}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{222 \textcolor{keyword}{    }\{}
\DoxyCodeLine{223       eigen\_assert(m\_isInitialized \&\& \textcolor{stringliteral}{"{}ComplexEigenSolver is not initialized."{}});}
\DoxyCodeLine{224       \textcolor{keywordflow}{return} m\_schur.info();}
\DoxyCodeLine{225     \}}
\DoxyCodeLine{226 }
\DoxyCodeLine{228     \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver}{ComplexEigenSolver}}\& \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a6592a682a9645f855c423b2a59861d1b}{setMaxIterations}}(\mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a8bd6f818f11487fa2eb4b01cb920ace6}{Index}} maxIters)}
\DoxyCodeLine{229     \{}
\DoxyCodeLine{230       m\_schur.setMaxIterations(maxIters);}
\DoxyCodeLine{231       \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{232     \}}
\DoxyCodeLine{233 }
\DoxyCodeLine{235     \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a8bd6f818f11487fa2eb4b01cb920ace6}{Index}} \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a38b46258ce744304049583123897368c}{getMaxIterations}}()}
\DoxyCodeLine{236     \{}
\DoxyCodeLine{237       \textcolor{keywordflow}{return} m\_schur.getMaxIterations();}
\DoxyCodeLine{238     \}}
\DoxyCodeLine{239 }
\DoxyCodeLine{240   \textcolor{keyword}{protected}:}
\DoxyCodeLine{241 }
\DoxyCodeLine{242     EIGEN\_STATIC\_ASSERT\_NON\_INTEGER(\mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a529599511298b96c3aa8c076807adcd9}{Scalar}})}
\DoxyCodeLine{243 }
\DoxyCodeLine{244     \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a8f3a8e3a570ca7e6df9a5ebfaa832d59}{EigenvectorType}} m\_eivec;}
\DoxyCodeLine{245     \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_af1d033d8c14e9461203d960c000bb72b}{EigenvalueType}} m\_eivalues;}
\DoxyCodeLine{246     \mbox{\hyperlink{classEigen_1_1ComplexSchur}{ComplexSchur<MatrixType>}} m\_schur;}
\DoxyCodeLine{247     \textcolor{keywordtype}{bool} m\_isInitialized;}
\DoxyCodeLine{248     \textcolor{keywordtype}{bool} m\_eigenvectorsOk;}
\DoxyCodeLine{249     \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a8f3a8e3a570ca7e6df9a5ebfaa832d59}{EigenvectorType}} m\_matX;}
\DoxyCodeLine{250 }
\DoxyCodeLine{251   \textcolor{keyword}{private}:}
\DoxyCodeLine{252     \textcolor{keywordtype}{void} doComputeEigenvectors(RealScalar matrixnorm);}
\DoxyCodeLine{253     \textcolor{keywordtype}{void} sortEigenvalues(\textcolor{keywordtype}{bool} computeEigenvectors);}
\DoxyCodeLine{254 \};}
\DoxyCodeLine{255 }
\DoxyCodeLine{256 }
\DoxyCodeLine{257 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>}
\DoxyCodeLine{258 \textcolor{keyword}{template}<\textcolor{keyword}{typename} InputType>}
\DoxyCodeLine{259 ComplexEigenSolver<MatrixType>\& }
\DoxyCodeLine{260 \mbox{\hyperlink{classEigen_1_1ComplexEigenSolver_a2209320a0bb39725834c39fd92183cd6}{ComplexEigenSolver<MatrixType>::compute}}(\textcolor{keyword}{const} EigenBase<InputType>\& matrix, \textcolor{keywordtype}{bool} computeEigenvectors)}
\DoxyCodeLine{261 \{}
\DoxyCodeLine{262   \textcolor{comment}{// this code is inspired from Jampack}}
\DoxyCodeLine{263   eigen\_assert(matrix.cols() == matrix.rows());}
\DoxyCodeLine{264 }
\DoxyCodeLine{265   \textcolor{comment}{// Do a complex Schur decomposition, A = U T U\string^*}}
\DoxyCodeLine{266   \textcolor{comment}{// The eigenvalues are on the diagonal of T.}}
\DoxyCodeLine{267   m\_schur.compute(matrix.derived(), computeEigenvectors);}
\DoxyCodeLine{268 }
\DoxyCodeLine{269   \textcolor{keywordflow}{if}(m\_schur.info() == \mbox{\hyperlink{group__enums_gga85fad7b87587764e5cf6b513a9e0ee5ea671a2aeb0f527802806a441d58a80fcf}{Success}})}
\DoxyCodeLine{270   \{}
\DoxyCodeLine{271     m\_eivalues = m\_schur.matrixT().diagonal();}
\DoxyCodeLine{272     \textcolor{keywordflow}{if}(computeEigenvectors)}
\DoxyCodeLine{273       doComputeEigenvectors(m\_schur.matrixT().norm());}
\DoxyCodeLine{274     sortEigenvalues(computeEigenvectors);}
\DoxyCodeLine{275   \}}
\DoxyCodeLine{276 }
\DoxyCodeLine{277   m\_isInitialized = \textcolor{keyword}{true};}
\DoxyCodeLine{278   m\_eigenvectorsOk = computeEigenvectors;}
\DoxyCodeLine{279   \textcolor{keywordflow}{return} *\textcolor{keyword}{this};}
\DoxyCodeLine{280 \}}
\DoxyCodeLine{281 }
\DoxyCodeLine{282 }
\DoxyCodeLine{283 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>}
\DoxyCodeLine{284 \textcolor{keywordtype}{void} ComplexEigenSolver<MatrixType>::doComputeEigenvectors(RealScalar matrixnorm)}
\DoxyCodeLine{285 \{}
\DoxyCodeLine{286   \textcolor{keyword}{const} \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} n = m\_eivalues.size();}
\DoxyCodeLine{287 }
\DoxyCodeLine{288   matrixnorm = numext::maxi(matrixnorm,(std::numeric\_limits<RealScalar>::min)());}
\DoxyCodeLine{289 }
\DoxyCodeLine{290   \textcolor{comment}{// Compute X such that T = X D X\string^(-\/1), where D is the diagonal of T.}}
\DoxyCodeLine{291   \textcolor{comment}{// The matrix X is unit triangular.}}
\DoxyCodeLine{292   m\_matX = EigenvectorType::Zero(n, n);}
\DoxyCodeLine{293   \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} k=n-\/1 ; k>=0 ; k-\/-\/)}
\DoxyCodeLine{294   \{}
\DoxyCodeLine{295     m\_matX.coeffRef(k,k) = ComplexScalar(1.0,0.0);}
\DoxyCodeLine{296     \textcolor{comment}{// Compute X(i,k) using the (i,k) entry of the equation X T = D X}}
\DoxyCodeLine{297     \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} i=k-\/1 ; i>=0 ; i-\/-\/)}
\DoxyCodeLine{298     \{}
\DoxyCodeLine{299       m\_matX.coeffRef(i,k) = -\/m\_schur.matrixT().coeff(i,k);}
\DoxyCodeLine{300       \textcolor{keywordflow}{if}(k-\/i-\/1>0)}
\DoxyCodeLine{301         m\_matX.coeffRef(i,k) -\/= (m\_schur.matrixT().row(i).segment(i+1,k-\/i-\/1) * m\_matX.col(k).segment(i+1,k-\/i-\/1)).value();}
\DoxyCodeLine{302       ComplexScalar z = m\_schur.matrixT().coeff(i,i) -\/ m\_schur.matrixT().coeff(k,k);}
\DoxyCodeLine{303       \textcolor{keywordflow}{if}(z==ComplexScalar(0))}
\DoxyCodeLine{304       \{}
\DoxyCodeLine{305         \textcolor{comment}{// If the i-\/th and k-\/th eigenvalue are equal, then z equals 0.}}
\DoxyCodeLine{306         \textcolor{comment}{// Use a small value instead, to prevent division by zero.}}
\DoxyCodeLine{307         numext::real\_ref(z) = NumTraits<RealScalar>::epsilon() * matrixnorm;}
\DoxyCodeLine{308       \}}
\DoxyCodeLine{309       m\_matX.coeffRef(i,k) = m\_matX.coeff(i,k) / z;}
\DoxyCodeLine{310     \}}
\DoxyCodeLine{311   \}}
\DoxyCodeLine{312 }
\DoxyCodeLine{313   \textcolor{comment}{// Compute V as V = U X; now A = U T U\string^* = U X D X\string^(-\/1) U\string^* = V D V\string^(-\/1)}}
\DoxyCodeLine{314   m\_eivec.noalias() = m\_schur.matrixU() * m\_matX;}
\DoxyCodeLine{315   \textcolor{comment}{// .. and normalize the eigenvectors}}
\DoxyCodeLine{316   \textcolor{keywordflow}{for}(\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} k=0 ; k<n ; k++)}
\DoxyCodeLine{317   \{}
\DoxyCodeLine{318     m\_eivec.col(k).normalize();}
\DoxyCodeLine{319   \}}
\DoxyCodeLine{320 \}}
\DoxyCodeLine{321 }
\DoxyCodeLine{322 }
\DoxyCodeLine{323 \textcolor{keyword}{template}<\textcolor{keyword}{typename} MatrixType>}
\DoxyCodeLine{324 \textcolor{keywordtype}{void} ComplexEigenSolver<MatrixType>::sortEigenvalues(\textcolor{keywordtype}{bool} computeEigenvectors)}
\DoxyCodeLine{325 \{}
\DoxyCodeLine{326   \textcolor{keyword}{const} \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} n =  m\_eivalues.size();}
\DoxyCodeLine{327   \textcolor{keywordflow}{for} (\mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} i=0; i<n; i++)}
\DoxyCodeLine{328   \{}
\DoxyCodeLine{329     \mbox{\hyperlink{namespaceEigen_a62e77e0933482dafde8fe197d9a2cfde}{Index}} k;}
\DoxyCodeLine{330     m\_eivalues.cwiseAbs().tail(n-\/i).minCoeff(\&k);}
\DoxyCodeLine{331     \textcolor{keywordflow}{if} (k != 0)}
\DoxyCodeLine{332     \{}
\DoxyCodeLine{333       k += i;}
\DoxyCodeLine{334       std::swap(m\_eivalues[k],m\_eivalues[i]);}
\DoxyCodeLine{335       \textcolor{keywordflow}{if}(computeEigenvectors)}
\DoxyCodeLine{336     m\_eivec.col(i).swap(m\_eivec.col(k));}
\DoxyCodeLine{337     \}}
\DoxyCodeLine{338   \}}
\DoxyCodeLine{339 \}}
\DoxyCodeLine{340 }
\DoxyCodeLine{341 \} \textcolor{comment}{// end namespace Eigen}}
\DoxyCodeLine{342 }
\DoxyCodeLine{343 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// EIGEN\_COMPLEX\_EIGEN\_SOLVER\_H}}

\end{DoxyCode}
